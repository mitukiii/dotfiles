#!/usr/bin/env ruby

require 'rainbow'

class String
  COLORS = Sickill::Rainbow::TERM_COLORS.keys - [:default, :black, :white]

  def color_code
    COLORS[each_byte.map(&:to_i).inject(&:+) % COLORS.size]
  end

  def auto_color
    color(color_code)
  end

  def colorize(pattern)
    split(/(#{pattern})/).map { |s|
      s =~ /#{pattern}/ ? s.auto_color.bright.underline : s
    }.join('')
  end
end

$stdin.each_line do |line|
  ARGV.each do |args|
    line = line.colorize(args)
  end
  puts line
  break if $stdin.closed?
end
